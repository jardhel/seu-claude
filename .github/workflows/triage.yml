name: Issue Triage

on:
  issues:
    types: [opened]

permissions:
  issues: write

jobs:
  triage:
    runs-on: ubuntu-latest
    steps:
      - name: Add needs-triage label
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.addLabels({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: ['needs-triage']
            })
      
      - name: Add area labels based on title
        uses: actions/github-script@v7
        with:
          script: |
            const title = context.payload.issue.title.toLowerCase();
            const labels = [];
            
            if (title.includes('index') || title.includes('crawl')) {
              labels.push('area: indexing');
            }
            if (title.includes('search') || title.includes('query')) {
              labels.push('area: search');
            }
            if (title.includes('parse') || title.includes('ast') || title.includes('tree-sitter')) {
              labels.push('area: parser');
            }
            if (title.includes('vector') || title.includes('embed') || title.includes('lancedb')) {
              labels.push('area: vectors');
            }
            
            if (labels.length > 0) {
              github.rest.issues.addLabels({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                labels: labels
              });
            }
      
      - name: Comment on new issue
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: 'Thank you for opening an issue! ðŸŽ‰\n\nA maintainer will review this soon. In the meantime:\n- Please ensure you\'ve provided all requested information\n- Check our [documentation](https://github.com/jardhel/seu-claude#readme)\n- See if [existing discussions](https://github.com/jardhel/seu-claude/discussions) might help'
            })
